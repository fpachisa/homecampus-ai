@import "tailwindcss";
@import "katex/dist/katex.min.css";

@layer base {
  html {
    font-family: Georgia, "Times New Roman", Times, serif;
  }

  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

@layer utilities {
  .scroll-smooth {
    scroll-behavior: smooth;
  }

  .message-appear {
    animation: messageAppear 0.3s ease-out;
  }

  @keyframes messageAppear {
    from {
      opacity: 0;
      transform: translateY(10px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .pulse-glow {
    animation: pulseGlow 2s infinite;
  }

  @keyframes pulseGlow {
    0%, 100% {
      box-shadow: 0 0 5px rgba(59, 130, 246, 0.3);
    }
    50% {
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.6), 0 0 30px rgba(59, 130, 246, 0.4);
    }
  }

  /* ============================================================================
     MATHTEXT LIST STYLING FIX
     ============================================================================

     PROBLEM SOLVED:
     When markdown lists contain LaTeX math expressions, browser default <li>
     styling causes LaTeX to break onto separate lines.

     Example Input (from AI-generated question):
       * Length (AB) = $15\text{ cm}$
       * Width (BC) = $10\text{ m}$

     Without this fix, renders as:
       ‚Ä¢ Length (AB) =
         15 cm              ‚Üê LaTeX on new line (BAD - reported by user)
       ‚Ä¢ Width (BC) =
         10 m

     With this fix, renders as:
       ‚Ä¢ Length (AB) = 15 cm   ‚Üê LaTeX inline (GOOD)
       ‚Ä¢ Width (BC) = 10 m

     ROOT CAUSE:
     1. MathText.tsx extracts LaTeX: "* Length = ‚ü®‚ü®MATH0‚ü©‚ü©"
     2. marked.parse() converts to: "<li>Length = ‚ü®‚ü®MATH0‚ü©‚ü©</li>"
     3. Browser default <li> has display:list-item with line breaks
     4. Result: text and math render on different lines

     IMPLEMENTATION:
     - Applied via .math-text-with-lists class in MathText.tsx (line 141)
     - Only active when hasBlockMarkdown=true (lists, headers, etc.)
     - Reduces spacing while maintaining readability and accessibility

     HISTORY:
     - Added: January 2025
     - Issue: User reported "extra line breaks in list items with LaTeX"
     - Debug: Check MathText.tsx console for "üîç MathText block markdown detected"
     - Related: MathText.tsx lines 109-141 (comprehensive comment block)

     TESTING:
     To verify this fix works, test with:
       "* Length = $15\text{ cm}$\n* Width = $10\text{ m}$"
     Should render as compact list with math inline, not separate lines.

     DO NOT REMOVE without testing the above case first!
     ============================================================================ */

  .math-text-with-lists ul,
  .math-text-with-lists ol {
    margin: 0.5em 0;           /* Reduced from browser default ~1em */
    padding-left: 1.5em;       /* Standard indent for bullets */
    line-height: 1.6;          /* Comfortable reading line height */
  }

  .math-text-with-lists li {
    margin: 0.25em 0;          /* Minimal spacing between list items */
    line-height: 1.6;          /* Match parent line-height */
  }

  /* Ensure KaTeX (LaTeX renderer) inside list items displays inline */
  .math-text-with-lists li .katex {
    display: inline;           /* Force inline, override any block defaults */
    margin: 0;                 /* No extra margin around math expressions */
  }

  /* ============================================================================
     INLINE MATH WRAPPING FIX
     ============================================================================

     PROBLEM SOLVED:
     Inline math expressions like $\sin(A)$ were wrapping to a new line when they
     appeared at the end of long sentences.

     Example: "what is the value of $\sin(A)$?"
     Without fix: "what is the value of"  (line break here)
                  "sin(A)?"
     With fix: "what is the value of sin(A)?" (stays together)

     SOLUTION:
     - Keep inline math with preceding word using white-space
     - Allow wrapping if math+context is too long
     ============================================================================ */

  .katex {
    display: inline !important;  /* Ensure KaTeX is always inline, not block */
  }

  /* Prevent awkward line breaks before/within inline math */
  .math-renderer {
    display: inline-block;       /* Prevent line breaks before math - treat as atomic unit */
    white-space: nowrap;         /* Prevent breaking within the math expression */
    vertical-align: baseline;    /* Align with text baseline for proper positioning */
  }

  /* Try to keep math with preceding text */
  span:has(> .math-renderer) {
    display: inline-block;             /* Ensure parent span stays inline too */
  }

  /* ============================================================================
     SCRATCH PAD - RESPONSIVE GRID LAYOUT
     ============================================================================

     Desktop/Tablet (‚â•1024px): Side-by-side layout with problem on left (60%),
     scratch pad on right (40%). Scratch pad is sticky and scrolls independently.

     Mobile (<1024px): Stacked layout with scratch pad below problem card.
     Scratch pad is collapsible to save screen space.
     ============================================================================ */

  .grid-layout-responsive {
    display: grid;
    gap: 1.5rem;
    grid-template-columns: 1fr; /* Mobile: stacked */
  }

  @media (min-width: 1024px) {
    .grid-layout-responsive {
      grid-template-columns: 60% 40%; /* Desktop: side-by-side */
      align-items: start;
    }

    .scratch-pad-column {
      position: sticky;
      top: 1rem;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }
  }

  /* ============================================================================
     SCRATCH PAD - VISUAL EFFECTS
     ============================================================================ */

  /* Grid paper background for drawing canvas */
  .canvas-grid-bg {
    background-color: #ffffff;
    background-image: radial-gradient(circle, #d1d5db 1px, transparent 1px);
    background-size: 20px 20px;
  }

  /* Lined paper effect for text mode */
  .text-lined-bg {
    background-color: #ffffff;
    background-image: repeating-linear-gradient(
      transparent,
      transparent 24px,
      #e5e7eb 24px,
      #e5e7eb 25px
    );
  }

  /* Smooth scrollbar for scratch pad on desktop */
  @media (min-width: 1024px) {
    .scratch-pad-column::-webkit-scrollbar {
      width: 8px;
    }

    .scratch-pad-column::-webkit-scrollbar-track {
      background: #f1f5f9;
      border-radius: 4px;
    }

    .scratch-pad-column::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 4px;
    }

    .scratch-pad-column::-webkit-scrollbar-thumb:hover {
      background: #94a3b8;
    }
  }
}
